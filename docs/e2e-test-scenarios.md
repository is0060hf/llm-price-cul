# LLM ランニングコスト算出 Web システム — E2E テストシナリオ

> 本ドキュメントは [docs/requirement.md](requirement.md) に定義されたすべての要件を検証するための E2E テストシナリオを定義する。
> テスト対象はデプロイ済みの Web アプリケーション全体であり、ユーザー操作の観点から検証を行う。

---

## テストシナリオ一覧

| カテゴリ | シナリオ数 | 参照セクション |
|---------|--------:|--------------|
| A. 画面表示・モード切替 | 5 | 要件 9 |
| B. ざっくり算定モード | 8 | 要件 2 |
| C. 詳細算定モード — 基本設定 | 6 | 要件 3.1 |
| D. 詳細算定モード — マルチエージェント構成 | 5 | 要件 3.2 |
| E. 詳細算定モード — RAG | 4 | 要件 3.3.1 |
| F. 詳細算定モード — 会話履歴参照 | 4 | 要件 3.3.2 |
| G. 詳細算定モード — Web 参照 | 4 | 要件 3.3.3 |
| H. 詳細算定モード — コスト調整 | 5 | 要件 3.4, 5.5 |
| I. システムプロンプト推定ヘルパー | 5 | 要件 4 |
| J. コスト計算結果の正確性 | 8 | 要件 5 |
| K. 上限値算定の保証 | 5 | 要件 1.1 |
| L. マスターデータ・API | 4 | 要件 7.2, 7.3 |
| M. 非機能要件 | 8 | 要件 8 |
| N. 非実装要件の確認 | 3 | 要件 7.2 |

---

## A. 画面表示・モード切替

> 参照: [requirement.md セクション 9](requirement.md#9-画面構成概要)

### A-1. 初期表示

- **操作**: アプリケーションの URL にアクセスする
- **期待結果**:
  - ヘッダー（アプリ名）が表示される
  - モード切替 UI（タブまたはトグル）が表示される
  - デフォルトでいずれかのモードのフォームが表示される
  - コンソールにエラーが出力されていない

### A-2. ざっくり算定モードへの切替

- **操作**: 「ざっくり算定」タブ/トグルをクリックする
- **期待結果**:
  - ざっくり算定モードのフォーム（5 入力項目）が表示される
  - 詳細算定モードのフォームは非表示である

### A-3. 詳細算定モードへの切替

- **操作**: 「詳細算定」タブ/トグルをクリックする
- **期待結果**:
  - 詳細算定モードのフォーム（基本設定 8 項目 + オプションセクション）が表示される
  - ざっくり算定モードのフォームは非表示である

### A-4. モード切替時の状態保持

- **操作**: ざっくり算定モードでいくつかの項目を入力した後、詳細算定モードに切替え、再度ざっくり算定モードに戻る
- **期待結果**:
  - ざっくり算定モードで入力した値が保持されている（またはリセットされる場合、その旨が明確である）

### A-5. マスターデータのロード

- **操作**: アプリケーションの URL にアクセスする
- **期待結果**:
  - モデル選択セレクトボックスにマスターデータから取得したモデル一覧が表示される
  - OpenAI / Anthropic / Google の 3 プロバイダーのモデルが含まれる
  - ローディング中はローディング表示（スピナー等）が出る

---

## B. ざっくり算定モード

> 参照: [requirement.md セクション 2](requirement.md#2-ざっくり算定モード)

### B-1. 全項目の入力と算出

- **操作**:
  1. 使用モデル: GPT-4.1 を選択
  2. 1 日あたりのリクエスト数: 100 を入力
  3. ユーザー入力文字数: 「中文（〜1,000 文字）」を選択
  4. 出力文字数: 「中文（〜1,500 文字）」を選択
  5. 用途タイプ: 「シンプル Q&A」を選択
  6. 「算出する」ボタンをクリック
- **期待結果**:
  - 月額コスト（USD）が表示される
  - 内訳にメインエージェント応答のみが表示される（RAG, 履歴, Web, 分類 はすべて OFF のため）
  - 参照: [requirement.md セクション 2.2](requirement.md#22-用途タイプ別プリセット) — シンプル Q&A の構成

### B-2. 用途タイプ「社内ナレッジ検索」

- **操作**: 用途タイプ「社内ナレッジ検索」を選択して算出する
- **期待結果**:
  - 内訳に RAG 関連のコスト（Embedding API 呼び出し + RAG チャンクのトークンコスト）が含まれる
  - 会話履歴、Web、分類のコストは含まれない
  - 参照: [requirement.md セクション 2.2](requirement.md#22-用途タイプ別プリセット) — 社内ナレッジ検索の構成

### B-3. 用途タイプ「カスタマーサポート」

- **操作**: 用途タイプ「カスタマーサポート」を選択して算出する
- **期待結果**:
  - 内訳に RAG、会話履歴参照、トピック分類、オーケストレータのコストが含まれる
  - Web 参照のコストは含まれない
  - 参照: [requirement.md セクション 2.2](requirement.md#22-用途タイプ別プリセット) — カスタマーサポートの構成

### B-4. 用途タイプ「汎用 AI アシスタント」

- **操作**: 用途タイプ「汎用 AI アシスタント」を選択して算出する
- **期待結果**:
  - 内訳に全処理ステップ（RAG、会話履歴参照、Web 参照、トピック分類、オーケストレータ、サブエージェント）のコストが含まれる
  - 参照: [requirement.md セクション 2.2](requirement.md#22-用途タイプ別プリセット) — 汎用 AI アシスタントの構成

### B-5. デフォルト値の適用確認

- **操作**: ざっくり算定モードで算出し、詳細算定モードに切り替えて同等の設定を手動入力する
- **期待結果**:
  - ざっくりモードの結果が、詳細モードで [requirement.md セクション 2.3](requirement.md#23-デフォルト値一覧ざっくりモード) のデフォルト値を設定した場合と同じ結果になる

### B-6. 入力文字数プリセット「短文」

- **操作**: ユーザー入力文字数「短文（〜200 文字）」、出力文字数「短文（〜500 文字）」を選択して算出する
- **期待結果**:
  - 入力 200 文字 / 出力 500 文字として計算されたコストが表示される

### B-7. 入力文字数プリセット「長文」

- **操作**: ユーザー入力文字数「長文（〜3,000 文字）」、出力文字数「長文（〜3,000 文字）」を選択して算出する
- **期待結果**:
  - 入力 3,000 文字 / 出力 3,000 文字として計算されたコストが表示される
  - B-6 よりも高いコストが算出される

### B-8. バリデーション

- **操作**: 1 日あたりのリクエスト数を空欄にして「算出する」ボタンをクリックする
- **期待結果**:
  - バリデーションエラーが表示される
  - コスト算出は実行されない

---

## C. 詳細算定モード — 基本設定

> 参照: [requirement.md セクション 3.1](requirement.md#31-基本設定必須)

### C-1. モデル選択のプロバイダー別グループ表示

- **操作**: 使用モデルのセレクトボックスを開く
- **期待結果**:
  - OpenAI / Anthropic / Google のプロバイダー別にモデルがグループ化されている
  - レガシーモデルが区別されている（または非表示/末尾に配置）

### C-2. 主要言語の選択

- **操作**: 主要言語を「日本語」→「英語」→「混在」に順番に切り替えて算出する
- **期待結果**:
  - 言語によってトークン換算係数が変わり、算出コストが異なる
  - 日本語（1.5 トークン/文字）が最も高コスト、英語（0.25 トークン/文字）が最も低コスト
  - 参照: [requirement.md セクション 5.1](requirement.md#51-トークン換算)

### C-3. 基本設定のみ（オプション全OFF）での算出

- **操作**:
  1. モデル: Claude Sonnet 4.5 を選択
  2. リクエスト数: 200
  3. 稼働日数: 20
  4. 入力最大文字数: 1,000
  5. 出力最大文字数: 1,500
  6. 主要言語: 日本語
  7. システムプロンプト文字数: 2,000
  8. 平均ターン数: 1
  9. すべてのオプションを OFF にする
  10. 「算出する」ボタンをクリック
- **期待結果**:
  - メインエージェント応答のみのコストが表示される
  - インプットトークン = (2,000 + 1,000) x 1.5 = 4,500 トークン
  - アウトプットトークン = 1,500 x 1.5 = 2,250 トークン
  - 1 リクエストあたりのコスト = (4,500 / 1,000,000 x $3.000) + (2,250 / 1,000,000 x $15.000) = $0.0135 + $0.03375 = $0.04725
  - 日次コスト = $0.04725 x 200 = $9.45
  - 月次コスト = $9.45 x 20 x 1.2（安全マージン 20%）= $226.80

### C-4. 稼働日数の変更

- **操作**: C-3 の条件で稼働日数を 30 に変更して算出する
- **期待結果**:
  - 月次コストが C-3 の 1.5 倍（30/20）になる

### C-5. 1 セッションあたりの平均ターン数の影響

- **操作**: C-3 の条件で平均ターン数を 5 に変更し、会話履歴参照を ON にして算出する
- **期待結果**:
  - 会話履歴によるインプットトークン増分が反映され、ターン数 1 の場合よりも高コストになる
  - 参照: [requirement.md セクション 5.4](requirement.md#54-会話履歴によるコスト増大の考慮)

### C-6. システムプロンプト文字数 0 での算出

- **操作**: システムプロンプト文字数を 0 にして算出する
- **期待結果**:
  - システムプロンプト分のトークンコストが 0 になり、ユーザー入力のみのコストが算出される

---

## D. 詳細算定モード — マルチエージェント構成

> 参照: [requirement.md セクション 3.2](requirement.md#32-マルチエージェント構成)

### D-1. トピック分類の有効化

- **操作**: トピック分類を ON にする
- **期待結果**:
  - フォールバック率（スライダー）と分類用モデル（セレクトボックス）が表示される
  - コスト内訳に「トピック分類」ステップが追加される（Embedding API + フォールバック率に応じた LLM 呼び出し）

### D-2. フォールバック率の変更

- **操作**: トピック分類を ON にし、フォールバック率を 0% → 50% → 100% に変更して算出する
- **期待結果**:
  - フォールバック率が高いほどトピック分類のコストが増加する
  - 0%: Embedding API のみ / 100%: Embedding API + LLM 呼び出し（毎回）

### D-3. オーケストレータの有効化

- **操作**: オーケストレータを ON にする
- **期待結果**:
  - オーケストレータ用モデルのセレクトボックスが表示される
  - コスト内訳に「オーケストレータ」ステップが追加される

### D-4. サブエージェント呼び出し回数の影響

- **操作**: サブエージェント最大呼び出し回数を 1 → 5 → 10 に変更して算出する
- **期待結果**:
  - 呼び出し回数に比例してサブエージェントのコストが増加する

### D-5. 異なるモデルの使い分け

- **操作**: メインエージェントに GPT-4.1、分類用に GPT-4.1 nano、オーケストレータに GPT-4.1 mini を設定して算出する
- **期待結果**:
  - 各処理ステップのコスト内訳にそれぞれ異なるモデルの料金が適用されている

---

## E. 詳細算定モード — RAG

> 参照: [requirement.md セクション 3.3.1](requirement.md#331-ragretrieval-augmented-generation)

### E-1. RAG の有効化と条件付きフォーム表示

- **操作**: RAG を ON にする
- **期待結果**:
  - 取得チャンク数、チャンクサイズ、Embedding モデル、リランキング有無が表示される

### E-2. RAG チャンク数・サイズの変更

- **操作**: チャンク数を 3 → 10 に、チャンクサイズを 500 → 1,000 に変更して算出する
- **期待結果**:
  - RAG によるインプットトークン増分 = チャンク数 x チャンクサイズ x トークン換算係数
  - 増分が正しくコストに反映されている

### E-3. リランキングの有効化

- **操作**: RAG ON の状態でリランキングを ON にする
- **期待結果**:
  - リランキング用モデルのセレクトボックスが表示される
  - コスト内訳にリランキングの LLM 呼び出しコストが追加される

### E-4. Embedding モデルの選択

- **操作**: Embedding モデルを text-embedding-3-small → text-embedding-3-large に変更して算出する
- **期待結果**:
  - Embedding API 呼び出しコストが変化する（$0.020 → $0.130 per 1M tokens）

---

## F. 詳細算定モード — 会話履歴参照

> 参照: [requirement.md セクション 3.3.2](requirement.md#332-会話履歴参照)

### F-1. 会話履歴参照の有効化と条件付きフォーム表示

- **操作**: 会話履歴参照を ON にする
- **期待結果**:
  - 最大ターン数、圧縮有無が表示される

### F-2. 最大ターン数の変更

- **操作**: 最大ターン数を 5 → 20 に変更して算出する
- **期待結果**:
  - 参照: [requirement.md セクション 5.4](requirement.md#54-会話履歴によるコスト増大の考慮)
  - 平均インプットトークン増分 = (ターン数 / 2) x (入力文字数 + 出力文字数) x トークン換算係数
  - ターン数 20 の方が高コストになる

### F-3. 会話履歴圧縮の有効化

- **操作**: 会話履歴参照 ON、圧縮 ON にする
- **期待結果**:
  - 圧縮頻度（数値入力）と圧縮用モデル（セレクトボックス）が表示される
  - コスト内訳に「会話履歴圧縮」ステップが追加される

### F-4. 圧縮頻度の変更

- **操作**: 圧縮頻度を 3 ターン → 10 ターンに変更して算出する
- **期待結果**:
  - 圧縮頻度が低い（数値が大きい）ほど圧縮コストが下がる（発生頻度 = 1 / 圧縮頻度）

---

## G. 詳細算定モード — Web 参照

> 参照: [requirement.md セクション 3.3.3](requirement.md#333-web-参照)

### G-1. Web 参照の有効化と条件付きフォーム表示

- **操作**: Web 参照を ON にする
- **期待結果**:
  - Web 検索 API 種類、検索回数、取得件数、要約処理有無が表示される

### G-2. 検索回数の変更

- **操作**: 1 リクエストあたりの検索回数を 1 → 5 に変更して算出する
- **期待結果**:
  - Web 検索 API コストが検索回数に比例して増加する

### G-3. 要約処理の有効化

- **操作**: Web 参照 ON の状態で要約処理を ON にする
- **期待結果**:
  - 要約用モデルのセレクトボックスが表示される
  - コスト内訳に要約処理の LLM 呼び出しコストが追加される

### G-4. Web 検索 API 種類による料金差

- **操作**: Web 検索 API をプロバイダー間で切り替えて算出する
- **期待結果**:
  - 各 API の単価に基づいた異なるコストが算出される
  - 参照: [requirement.md セクション 6.2〜6.4](requirement.md#62-openai-モデル料金一覧) の Web Search / Grounding 料金

---

## H. 詳細算定モード — コスト調整

> 参照: [requirement.md セクション 3.4](requirement.md#34-コスト調整) / [セクション 5.5](requirement.md#55-prompt-caching-計算ポリシー)

### H-1. Prompt Caching ON/OFF の切替

- **操作**: 同じ条件で Prompt Caching を OFF → ON に切り替えて算出する
- **期待結果**:
  - ON 時のコストが OFF 時より低い（システムプロンプト部分に Cache Read 単価が適用される）
  - 参照: [requirement.md セクション 5.5](requirement.md#55-prompt-caching-計算ポリシー) — Cache Read 単価のみ適用

### H-2. Prompt Caching — Anthropic モデルでの検証

- **操作**: Claude Sonnet 4.5 を選択し、Prompt Caching を ON にして算出する
- **期待結果**:
  - システムプロンプト部分に Cache Read 単価（$0.300/1M tokens）が適用される
  - それ以外の部分には通常 Input 単価（$3.000/1M tokens）が適用される
  - Cache Write コストは計算に含まれない

### H-3. 安全マージンの変更

- **操作**: 安全マージンを 0% → 20% → 50% に変更して算出する
- **期待結果**:
  - 月次コスト = 日次コスト x 稼働日数 x (1 + マージン率) の計算が正しい
  - 0%: マージンなし / 20%: 1.2 倍 / 50%: 1.5 倍

### H-4. 通貨切替（USD → JPY）

- **操作**: 表示通貨を JPY に変更する
- **期待結果**:
  - コスト表示が円建てに切り替わる
  - 為替レート入力欄が表示される（デフォルト 150 円/USD）
  - 表示金額 = USD 金額 x 為替レート
  - 参照: [requirement.md セクション 9](requirement.md#9-画面構成概要) — USD / JPY の切り替え表示

### H-5. 為替レートの変更

- **操作**: 通貨を JPY にし、為替レートを 150 → 160 に変更して算出する
- **期待結果**:
  - JPY 表示金額が 160/150 倍（約 1.067 倍）に増加する

---

## I. システムプロンプト推定ヘルパー

> 参照: [requirement.md セクション 4](requirement.md#4-システムプロンプト文字数の推定ヘルパー)

### I-1. ヘルパーの起動と表示

- **操作**: 詳細算定モードの「システムプロンプトの文字数」入力欄の横にあるヘルパー起動ボタンをクリックする
- **期待結果**:
  - ダイアログ/シートが開く
  - A〜E の全 5 カテゴリ（17 要素）のフォームが表示される

### I-2. 全要素の選択と推定文字数のリアルタイム更新

- **操作**: A1〜E4 の全 17 要素で任意の値を選択する
- **期待結果**:
  - 要素の選択が変わるたびに推定文字数がリアルタイムで更新表示される
  - 推定文字数 = ベース文字数（200 文字）+ Σ 各要素の文字数
  - 参照: [requirement.md セクション 4.2](requirement.md#42-推定ロジック)

### I-3. 全要素を最小値にした場合

- **操作**: 全要素で「なし」または最小の規模感を選択する
- **期待結果**:
  - 推定文字数 = ベース文字数（200 文字）のみが表示される

### I-4. 全要素を最大値にした場合

- **操作**: 全要素で最大の規模感を選択する
- **期待結果**:
  - 推定文字数が [requirement.md セクション 4.1](requirement.md#41-システムプロンプトを構成する要素一覧) の全要素の最大値合計 + 200 と一致する

### I-5. 推定値の適用

- **操作**: ヘルパーで推定した後「この値を適用」ボタンをクリックする
- **期待結果**:
  - ダイアログが閉じる
  - 「システムプロンプトの文字数」入力欄に推定値が反映される

---

## J. コスト計算結果の正確性

> 参照: [requirement.md セクション 5](requirement.md#5-コスト計算ロジック概要)

### J-1. 処理フロー全ステップの内訳表示

- **操作**: 詳細算定モードで全オプションを ON にして算出する
- **期待結果**:
  - 以下のすべての処理ステップが内訳に表示される:
    1. トピック分類（Embedding + LLM フォールバック）
    2. オーケストレータ
    3. RAG（Embedding + リランキング + チャンクトークン）
    4. Web 参照（検索 API + 要約）
    5. メインエージェント応答
    6. サブエージェント
    7. 会話履歴圧縮
  - 参照: [requirement.md セクション 5.2](requirement.md#52-1-リクエストあたりの処理フローと-api-呼び出し)

### J-2. トークン数内訳の表示

- **操作**: 算出結果の内訳を確認する
- **期待結果**:
  - 各処理ステップごとのインプット/アウトプットトークン数が表示される
  - 参照: [requirement.md セクション 9](requirement.md#9-画面構成概要) — インプット/アウトプットトークン数の内訳

### J-3. 日次・月次コストの表示

- **操作**: 算出結果を確認する
- **期待結果**:
  - 日次コストと月次コストの両方が表示される
  - 月次コスト = 日次コスト x 稼働日数 x (1 + 安全マージン率)
  - 参照: [requirement.md セクション 5.3](requirement.md#53-コスト算出式概要)

### J-4. グラフの表示

- **操作**: 算出結果を確認する
- **期待結果**:
  - コスト内訳の円グラフまたは棒グラフが表示される
  - グラフの各セグメントが処理ステップに対応している
  - 参照: [requirement.md セクション 9](requirement.md#9-画面構成概要) — コスト内訳のグラフ可視化

### J-5. 手計算との突合（シンプル構成）

- **操作**:
  - モデル: GPT-4.1（Input: $2.000, Output: $8.000）
  - リクエスト数: 100/日、稼働日数: 20
  - 入力: 1,000 文字、出力: 1,500 文字、言語: 日本語
  - システムプロンプト: 2,000 文字、ターン数: 1
  - オプション: 全 OFF、安全マージン: 20%
- **手計算**:
  - インプット = (2,000 + 1,000) x 1.5 = 4,500 トークン
  - アウトプット = 1,500 x 1.5 = 2,250 トークン
  - 1 リクエスト = (4,500 / 1M x $2.000) + (2,250 / 1M x $8.000) = $0.009 + $0.018 = $0.027
  - 日次 = $0.027 x 100 = $2.70
  - 月次 = $2.70 x 20 x 1.2 = $64.80
- **期待結果**: 表示された月次コストが $64.80 と一致する

### J-6. 手計算との突合（フル構成）

- **操作**:
  - モデル: Claude Sonnet 4.5（Input: $3.000, Output: $15.000）
  - リクエスト数: 50/日、稼働日数: 20
  - 入力: 500 文字、出力: 1,000 文字、言語: 日本語
  - システムプロンプト: 3,000 文字、ターン数: 5
  - RAG ON: チャンク 5 件 x 500 文字、Embedding: text-embedding-3-small
  - 会話履歴 ON: 最大ターン 10、圧縮なし
  - その他オプション OFF、安全マージン: 20%
- **手計算**: （省略。各ステップのトークン数と単価から算出）
- **期待結果**: 表示されたコストが手計算と一致する

### J-7. 安全マージン適用前後の比較

- **操作**: 算出結果を確認する
- **期待結果**:
  - 安全マージン適用前のコストと適用後のコストが比較表示される

### J-8. 0 リクエストでの算出

- **操作**: 1 日あたりのリクエスト数を 0 にして算出する
- **期待結果**:
  - 月次コスト = $0.00 が表示される（または 0 入力時にバリデーションエラーが出る）

---

## K. 上限値算定の保証

> 参照: [requirement.md セクション 1.1](requirement.md#11-目的) — 「最大でこれくらいになる（これ以上にはならない）」

### K-1. 全パラメータ最大値での算出

- **操作**: 全入力項目を最大の想定値に設定して算出する
  - 入力 3,000 文字、出力 3,000 文字、リクエスト数 1,000/日
  - 全オプション ON、最大チャンク数、最大ターン数
- **期待結果**:
  - システムがクラッシュせず、コストが算出される
  - 算出されたコストが合理的な範囲内である

### K-2. Prompt Caching ON が必ずコスト削減方向に作用する

- **操作**: 同じ条件で Prompt Caching を OFF → ON に切り替える
- **期待結果**:
  - ON 時のコストが OFF 時以下である（等しいまたは低い）
  - 参照: [requirement.md セクション 5.5](requirement.md#55-prompt-caching-計算ポリシー)

### K-3. 会話履歴ターン数増加がコスト増加方向に作用する

- **操作**: 会話履歴参照 ON で、最大ターン数を 5 → 10 → 20 に変更して算出する
- **期待結果**:
  - ターン数が多いほどコストが高くなる（単調増加）

### K-4. オプション追加がコスト増加方向に作用する

- **操作**: オプションを 1 つずつ ON にしていき、各ステップで算出する
  - 全 OFF → RAG ON → 履歴 ON → Web ON → 分類 ON → オーケストレータ ON
- **期待結果**:
  - オプションを追加するたびにコストが増加する（または同額以上になる）

### K-5. 安全マージン増加がコスト増加方向に作用する

- **操作**: 安全マージンを 0% → 10% → 20% → 50% に変更して算出する
- **期待結果**:
  - マージンが大きいほどコストが高くなる（単調増加）

---

## L. マスターデータ・API

> 参照: [requirement.md セクション 7.2](requirement.md#72-構成方針) / [セクション 7.3](requirement.md#73-データベース設計概要)

### L-1. API レスポンスの完全性

- **操作**: `GET /api/models` にリクエストを送信する
- **期待結果**:
  - レスポンスに providers, models, embedding_models, web_search_tools のデータが含まれる
  - models に [requirement.md セクション 6.2〜6.4](requirement.md#62-openai-モデル料金一覧) の全モデルが含まれる

### L-2. API レスポンスの型安全性

- **操作**: `GET /api/models` のレスポンスを検証する
- **期待結果**:
  - 全フィールドが期待する型（number, string, boolean, null）で返却される
  - 料金値が数値型である（文字列でない）

### L-3. DB 直接アクセスの非存在確認

- **操作**: ブラウザの開発者ツールでネットワークタブを確認する
- **期待結果**:
  - クライアントから DB への直接接続（PostgreSQL プロトコル等）が行われていない
  - マスターデータの取得は `/api/models` 経由のみである
  - 参照: [requirement.md セクション 7.2](requirement.md#72-構成方針) — 「クライアントから直接 DB アクセスしない」

### L-4. API エラーハンドリング

- **操作**: API が一時的にエラーを返す状況を想定する（DB 接続エラー等）
- **期待結果**:
  - 適切なエラーメッセージが表示される
  - アプリケーションがクラッシュしない

---

## M. 非機能要件

> 参照: [requirement.md セクション 8](requirement.md#8-非機能要件)

### M-1. レスポンシブ — PC（1280px 以上）

- **操作**: PC ブラウザ（1280px 以上）で全画面表示する
- **期待結果**: レイアウトが崩れず、全機能が使用可能である

### M-2. レスポンシブ — タブレット（768px〜1279px）

- **操作**: ブラウザ幅を 768px〜1279px に設定する
- **期待結果**: レイアウトが適切に調整され、全機能が使用可能である

### M-3. レスポンシブ — スマートフォン（〜767px）

- **操作**: ブラウザ幅を 375px（iPhone SE 相当）に設定する
- **期待結果**:
  - フォーム入力項目が縦積みになり操作しやすい
  - グラフがスマートフォン幅に収まる
  - スクロールで全機能にアクセスできる

### M-4. WCAG 2.2 — フォームラベル

- **操作**: 全フォーム要素を検査する
- **期待結果**: すべての入力要素に適切な `<label>` が紐づいている

### M-5. WCAG 2.2 — キーボード操作

- **操作**: Tab キーのみで全操作を行う
- **期待結果**:
  - すべてのフォーム要素にフォーカスが移動する
  - フォーカスインジケーターが視認可能である
  - Enter/Space でボタン/トグルが操作可能である

### M-6. WCAG 2.2 — コントラスト比

- **操作**: ブラウザの開発者ツールまたはアクセシビリティ検証ツールでコントラスト比を確認する
- **期待結果**: テキストと背景のコントラスト比が 4.5:1 以上（AA 基準）を満たす

### M-7. ブラウザ互換性

- **操作**: Chrome, Firefox, Safari, Edge の各最新版で全機能を確認する
- **期待結果**: 表示崩れ・機能不全がない

### M-8. コンソールエラー

- **操作**: 全機能を一通り操作した後、ブラウザのコンソールを確認する
- **期待結果**: エラー（赤色）が出力されていない

---

## N. 非実装要件の確認

> 参照: [requirement.md セクション 7.2](requirement.md#72-構成方針) — 認証不要、管理画面不要、算出履歴の保存不要

### N-1. 認証機能が存在しないことの確認

- **操作**: アプリケーションのすべての URL パスにアクセスする
- **期待結果**:
  - ログイン画面・認証ダイアログが存在しない
  - 認証なしで全機能が使用可能である
  - 参照: [requirement.md セクション 7.2](requirement.md#72-構成方針) — 「認証: 不要」

### N-2. 管理画面が存在しないことの確認

- **操作**: `/admin`, `/dashboard`, `/settings` 等の一般的な管理画面パスにアクセスする
- **期待結果**:
  - 管理画面が存在しない（404 が返される）
  - 参照: [requirement.md セクション 7.2](requirement.md#72-構成方針) — 「管理画面: 不要」

### N-3. 算出結果が永続化されないことの確認

- **操作**:
  1. コスト算出を実行する
  2. ブラウザをリロードする
  3. ブラウザの開発者ツールでネットワークタブを確認する
- **期待結果**:
  - リロード後に前回の算出結果が表示されない
  - 算出結果を保存する POST/PUT リクエストが送信されていない
  - 参照: [requirement.md セクション 7.2](requirement.md#72-構成方針) — 「算出履歴の保存: 不要」
