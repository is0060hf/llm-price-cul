# LLM ランニングコスト算出 Web システム — 要件定義書

## 1. システム概要

### 1.1 目的

AI エージェントを Web システムに組み込む際に必要となる月額ランニングコストを、事前に概算できる Web システムを構築する。
マルチエージェント構成における各処理ステップの API 呼び出しコストを考慮し、「最大でこれくらいになる（これ以上にはならない）」という上限値を算定する。

### 1.2 背景

- AI エージェント導入時、必ずランニングコストの見積もりを求められる
- マルチエージェント構成では、1 ユーザーリクエストあたり複数回の LLM/API 呼び出しが発生するため、単純な計算では見積もれない
- モデルごとに料金体系が異なり、処理ステップごとに使用モデルを変える場合もある

### 1.3 算定モード

本システムは **2 つの算定モード** を提供する。

| モード | 概要 | 対象ユーザー |
|--------|------|-------------|
| **ざっくり算定モード** | 最小限の入力のみでコストを概算。残りのパラメータは一般的なデフォルト値を使用 | 初期検討段階の企画者・営業担当など |
| **詳細算定モード** | すべてのパラメータを個別に設定し、精密にコストを算出 | 設計段階のエンジニア・アーキテクトなど |

---

## 2. ざっくり算定モード

### 2.1 ユーザー入力項目（最小限）

| # | 入力項目 | 入力形式 | 説明 |
|---|---------|---------|------|
| 1 | 使用モデル | セレクトボックス | GPT-4o, Claude 3.5 Sonnet 等から選択 |
| 2 | 1 日あたりのリクエスト数 | 数値入力 | おおよその想定値 |
| 3 | 1 回あたりのユーザー入力文字数 | プリセット選択 | 短文（〜200 文字）/ 中文（〜1,000 文字）/ 長文（〜3,000 文字） |
| 4 | 1 回あたりの出力文字数 | プリセット選択 | 短文（〜500 文字）/ 中文（〜1,500 文字）/ 長文（〜3,000 文字） |
| 5 | 用途タイプ | セレクトボックス | 後述のプリセットから選択 |

### 2.2 用途タイプ別プリセット

用途タイプを選択すると、以下のパラメータが自動的にセットされる。

| 用途タイプ | 想定構成 | 自動設定されるオプション |
|-----------|---------|----------------------|
| **シンプル Q&A** | 単一エージェント、履歴なし | RAG: OFF, 履歴: OFF, Web: OFF, 分類: OFF |
| **社内ナレッジ検索** | RAG 付き単一エージェント | RAG: ON, 履歴: OFF, Web: OFF, 分類: OFF |
| **カスタマーサポート** | 履歴付きマルチエージェント | RAG: ON, 履歴: ON, Web: OFF, 分類: ON, オーケストレータ: ON |
| **汎用 AI アシスタント** | フル構成マルチエージェント | RAG: ON, 履歴: ON, Web: ON, 分類: ON, オーケストレータ: ON |

### 2.3 デフォルト値一覧（ざっくりモード）

ざっくりモードで自動適用されるデフォルト値。

| パラメータ | デフォルト値 | 根拠 |
|-----------|------------|------|
| 主要言語 | 日本語 | 日本国内利用を想定 |
| 月の稼働日数 | 20 日（平日のみ） | 一般的な営業日数 |
| システムプロンプト文字数 | 2,000 文字 | 一般的なエージェント構成の中央値 |
| 1 セッションあたりの平均ターン数 | 5 ターン | 一般的なチャットサポートの平均 |
| RAG 取得チャンク数 | 5 件 | 一般的な設定値 |
| RAG 1 チャンクあたりの文字数 | 500 文字 | 一般的なチャンクサイズ |
| 会話履歴の参照ターン数 | 10 ターン | 一般的な上限値 |
| 会話履歴圧縮 | なし | シンプル構成を想定 |
| Web 検索取得件数 | 3 件 | 一般的な設定値 |
| 分類のフォールバック率 | 20% | 一般的な推定値 |
| サブエージェント最大呼び出し回数 | 2 回 | 一般的な構成 |
| Prompt Caching | なし | 保守的な見積もり |
| 安全マージン | 20% | 一般的なバッファ |
| 為替レート | 手動入力（デフォルト 150 円/USD） | 変動するため |

---

## 3. 詳細算定モード

### 3.1 基本設定（必須）

| # | 入力項目 | 入力形式 | 説明 |
|---|---------|---------|------|
| 1 | 使用モデル | セレクトボックス | メインエージェントに使用するモデル |
| 2 | 1 日あたりの最大リクエスト数 | 数値入力 | ピーク時の最大値 |
| 3 | 月の稼働日数 | 数値入力（デフォルト: 20） | 平日のみ or 全日 |
| 4 | 1 回あたりのユーザー入力最大文字数 | 数値入力 | ユーザーが送信するメッセージの上限 |
| 5 | 1 回あたりの出力最大文字数 | 数値入力 | AI が生成するレスポンスの上限 |
| 6 | 主要言語 | セレクトボックス | 日本語 / 英語 / 混在（トークン換算係数に影響） |
| 7 | システムプロンプトの文字数 | 数値入力 or 推定ヘルパー | 直接入力、または後述の推定ヘルパーで算出 |
| 8 | 1 セッションあたりの平均ターン数 | 数値入力 | 会話の往復回数 |

### 3.2 マルチエージェント構成

| # | 入力項目 | 入力形式 | 説明 |
|---|---------|---------|------|
| 9 | トピック分類の有無 | トグル | セマンティック分類 + LLM フォールバック |
| 10 | セマンティック分類のフォールバック率 | スライダー（%） | LLM 分類に回る割合（デフォルト: 20%） |
| 11 | 分類用モデル | セレクトボックス | 軽量モデルを選択可能 |
| 12 | オーケストレータの有無 | トグル | オーケストレータ自体の LLM 呼び出し |
| 13 | オーケストレータ用モデル | セレクトボックス | メインと異なるモデルを選択可能 |
| 14 | サブエージェント最大呼び出し回数 | 数値入力 | 1 リクエストあたりの最大値 |
| 15 | サブエージェント用モデル | セレクトボックス | 各サブエージェントのモデル |

### 3.3 オプション機能

#### 3.3.1 RAG（Retrieval-Augmented Generation）

| # | 入力項目 | 入力形式 | 説明 |
|---|---------|---------|------|
| 16 | RAG の有無 | トグル | — |
| 17 | 1 クエリあたりの取得チャンク数 | 数値入力 | 取得する文書チャンクの数 |
| 18 | 1 チャンクあたりの平均文字数 | 数値入力 | チャンクサイズ |
| 19 | Embedding モデル | セレクトボックス | text-embedding-3-small 等 |
| 20 | リランキング（LLM ベース）の有無 | トグル | LLM による取得結果の再評価 |
| 21 | リランキング用モデル | セレクトボックス | リランキングに使用するモデル |

#### 3.3.2 会話履歴参照

| # | 入力項目 | 入力形式 | 説明 |
|---|---------|---------|------|
| 22 | 会話履歴参照の有無 | トグル | — |
| 23 | 参照する最大ターン数 | 数値入力 | コンテキストに含める最大ターン数 |
| 24 | 会話履歴圧縮の有無 | トグル | 圧縮処理を行うか |
| 25 | 圧縮頻度（何ターンごと） | 数値入力 | 圧縮を実行する間隔 |
| 26 | 圧縮用モデル | セレクトボックス | 圧縮処理に使用するモデル |

#### 3.3.3 Web 参照

| # | 入力項目 | 入力形式 | 説明 |
|---|---------|---------|------|
| 27 | Web 参照の有無 | トグル | — |
| 28 | Web 検索 API の種類 | セレクトボックス | Bing Search API / Google Custom Search 等 |
| 29 | 1 リクエストあたりの検索回数 | 数値入力 | エージェントが実行する検索の回数 |
| 30 | 検索結果の取得件数 | 数値入力 | コンテキストに含めるページ数 |
| 31 | 検索結果の要約処理の有無 | トグル | 要約する場合は追加 LLM 呼び出し |
| 32 | 要約用モデル | セレクトボックス | 要約処理に使用するモデル |

### 3.4 コスト調整

| # | 入力項目 | 入力形式 | 説明 |
|---|---------|---------|------|
| 33 | Prompt Caching の利用有無 | トグル | キャッシュヒット時の割引を適用 |
| 34 | 安全マージン | スライダー（%） | リトライ・エラー再送等のバッファ（デフォルト: 20%） |
| 35 | 表示通貨 | セレクトボックス | USD / JPY |
| 36 | 為替レート | 数値入力 | JPY 表示時に使用（デフォルト: 150 円/USD） |

---

## 4. システムプロンプト文字数の推定ヘルパー

詳細算定モードにおいて、システムプロンプトの正確な文字数が不明な場合に使用する推定機能。
以下の要素の有無・程度をチェックリスト形式で選択すると、おおよそのシステムプロンプト文字数を推定する。

### 4.1 システムプロンプトを構成する要素一覧

#### A. 行動制約・ガードレール系

| # | 要素 | 規模感の目安（少 / 中 / 多） | 影響度 |
|---|------|---------------------------|--------|
| A1 | ガードレール（制約・禁止事項） | 少（〜5 個）: +200 文字 / 中（〜15 個）: +600 文字 / 多（30 個〜）: +1,500 文字 | 中〜大 |
| A2 | 倫理・コンプライアンス・法的制約 | 少（業界標準）: +300 文字 / 中（準拠型業界）: +600 文字 / 多（金融・医療等の厳格業界）: +1,000 文字 | 中〜大 |
| A3 | 禁止トピック・話題制限の列挙 | 少（〜5 件）: +100 文字 / 中（〜15 件）: +300 文字 / 多（30 件〜）: +500 文字 | 中 |
| A4 | 優先順位・競合解決ルール | 少（〜3 ルール）: +100 文字 / 中（〜8 ルール）: +250 文字 / 多（15 ルール〜）: +400 文字 | 小〜中 |
| A5 | エラーハンドリング指示 | 少（基本的）: +200 文字 / 中（主要パターン網羅）: +400 文字 / 多（詳細・分岐網羅）: +600 文字 | 中 |

#### B. ナレッジ・ドメイン系

| # | 要素 | 規模感の目安（少 / 中 / 多） | 影響度 |
|---|------|---------------------------|--------|
| B1 | ドメインナレッジ・専門用語定義 | 少（〜10 語）: +300 文字 / 中（〜30 語）: +1,000 文字 / 多（50 語〜）: +2,000 文字 | 大 |
| B2 | Few-shot 例示（入出力例） | 少（1 例）: +500 文字 / 中（2 例）: +1,000 文字 / 多（3 例以上）: +2,000 文字 | 極大 |
| B3 | ワークフロー・状態遷移の定義 | 少（3 段階）: +300 文字 / 中（5〜7 段階）: +800 文字 / 多（10 段階〜）: +1,500 文字 | 大 |

#### C. 入出力制御系

| # | 要素 | 規模感の目安（少 / 中 / 多） | 影響度 |
|---|------|---------------------------|--------|
| C1 | 出力フォーマット指定 | 少（テキスト）: +100 文字 / 中（マークダウン等）: +400 文字 / 多（JSON スキーマ等）: +800 文字 | 中〜大 |
| C2 | ペルソナ・トーン設定 | 少（簡易）: +100 文字 / 中（標準）: +250 文字 / 多（詳細）: +400 文字 | 小〜中 |
| C3 | 回答の長さ・詳細度の制御 | 少: +50 文字 / 中: +100 文字 / 多: +200 文字 | 小 |
| C4 | 引用・ソース明示ルール | 少: +100 文字 / 中: +200 文字 / 多: +300 文字 | 小〜中 |
| C5 | 多言語対応指示 | 少（基本的）: +200 文字 / 中（標準）: +400 文字 / 多（詳細）: +600 文字 | 中 |

#### D. ツール・外部連携系

| # | 要素 | 規模感の目安（少 / 中 / 多） | 影響度 |
|---|------|---------------------------|--------|
| D1 | ツール/Function 定義の使用指示 | 少（1〜3 ツール）: +500 文字 / 中（4〜7 ツール）: +1,500 文字 / 多（10 ツール〜）: +3,000 文字 | 大 |
| D2 | RAG・Web 等の参照先に関する指示 | 少（基本的）: +300 文字 / 中（標準）: +500 文字 / 多（詳細）: +800 文字 | 中〜大 |
| D3 | 外部 API 連携の手順・条件 | 少（1 API）: +300 文字 / 中（2〜3 API）: +600 文字 / 多（4 API〜）: +1,000 文字 | 大 |

#### E. コンテキスト・セッション系

| # | 要素 | 規模感の目安（少 / 中 / 多） | 影響度 |
|---|------|---------------------------|--------|
| E1 | ユーザーセグメント別の対応指示 | 少（2〜3 セグメント）: +300 文字 / 中（4 セグメント）: +600 文字 / 多（5 セグメント〜）: +1,000 文字 | 中〜大 |
| E2 | 動的コンテキスト注入枠 | 少: +100 文字 / 中: +300 文字 / 多: +500 文字 | 中 |
| E3 | マルチステップ推論の手順指示 | 少（簡易）: +200 文字 / 中（標準）: +500 文字 / 多（詳細）: +800 文字 | 中〜大 |
| E4 | 特殊条件による例外処理 | 少（〜3 条件）: +200 文字 / 中（4〜7 条件）: +500 文字 / 多（10 条件〜）: +1,000 文字 | 中〜大 |

### 4.2 推定ロジック

各要素の選択に応じた文字数を合算し、システムプロンプトの推定文字数を算出する。

```
推定システムプロンプト文字数 = ベース文字数（200文字）+ Σ 各要素の文字数
```

---

## 5. コスト計算ロジック概要

### 5.1 トークン換算

| 言語 | 1 文字あたりのトークン数（目安） |
|------|-------------------------------|
| 日本語 | 約 1.0〜1.5 トークン/文字 |
| 英語 | 約 0.25 トークン/文字 |
| 混在 | 約 0.7 トークン/文字 |

※ モデルのトークナイザーにより変動するため、保守的な値を採用する。

### 5.2 1 リクエストあたりの処理フローと API 呼び出し

```
ユーザーリクエスト受信
│
├─ [トピック分類が有効な場合]
│   ├─ セマンティック分類 → Embedding API 呼び出し（1回）
│   └─ フォールバック時 → LLM API 呼び出し（1回、発生率に応じて）
│
├─ [オーケストレータが有効な場合]
│   └─ ルーティング判断 → LLM API 呼び出し（1回）
│
├─ [RAG が有効な場合]
│   ├─ クエリ埋め込み → Embedding API 呼び出し（1回）
│   ├─ ベクトル検索 → インフラコスト（本システムでは対象外）
│   └─ [リランキングが有効な場合] → LLM API 呼び出し（1回）
│
├─ [Web 参照が有効な場合]
│   ├─ Web 検索 → 検索 API 呼び出し（N回）
│   └─ [要約処理が有効な場合] → LLM API 呼び出し（1回）
│
├─ [会話履歴参照が有効な場合]
│   └─ 履歴をコンテキストに追加（トークン増加）
│
├─ メインエージェント応答生成 → LLM API 呼び出し（1回）
│   ※ インプット = システムプロンプト + 会話履歴 + RAG チャンク + Web 結果 + ユーザー入力
│
├─ [サブエージェントが呼ばれる場合]
│   └─ LLM API 呼び出し（N回、最大呼び出し回数分）
│
└─ [会話履歴圧縮が有効な場合（条件を満たした時）]
    └─ 圧縮処理 → LLM API 呼び出し（1回、頻度に応じて）
```

### 5.3 コスト算出式（概要）

```
月額コスト = 日次コスト × 月の稼働日数 × (1 + 安全マージン率)

日次コスト = 1日あたりのリクエスト数 × 1リクエストあたりのコスト

1リクエストあたりのコスト = Σ 各処理ステップのコスト

各処理ステップのコスト =
  (インプットトークン数 × インプット単価) + (アウトプットトークン数 × アウトプット単価)
```

### 5.4 会話履歴によるコスト増大の考慮

会話履歴を参照する場合、ターン数の増加に伴いインプットトークンが増大する。
最大コストを算出するため、**平均ターン数の中間値**でのコストを基準とする。

```
平均インプットトークン増分 = (最大参照ターン数 / 2) × (平均入力文字数 + 平均出力文字数) × トークン換算係数
```

### 5.5 Prompt Caching 計算ポリシー

Prompt Caching の利用有無（セクション 3.4 #33）が有効な場合のコスト計算ポリシーを以下に定める。

#### 前提

- 各プロバイダーの Prompt Caching 料金体系は以下の通り異なる:
  - **OpenAI / Google**: Cached Input 単価（= キャッシュヒット時の割引単価）の 1 種類のみ
  - **Anthropic**: Cache Write（書き込み時、通常の Input 単価より**高い**）+ Cache Read（読み取り時、通常の Input 単価より**大幅に安い**）の 2 種類
- Cache Write は TTL（5 分〜1 時間）ごとに 1 回発生し、以降の同一 TTL 内リクエストは Cache Read となる

#### 計算ポリシー

| 条件 | 適用単価 | 理由 |
|------|---------|------|
| Prompt Caching **OFF** | 全インプットトークンに通常の Input 単価を適用 | キャッシュなしの最大コスト |
| Prompt Caching **ON**（システムプロンプト部分） | **Cache Read 単価**を適用 | 定常運用ではほぼ全リクエストがキャッシュヒットするため |
| Prompt Caching **ON**（システムプロンプト以外の部分） | 通常の Input 単価を適用 | ユーザー入力・会話履歴・RAG チャンク等はキャッシュ対象外 |

#### Cache Write コストについて

Cache Write コストは本システムの計算には**含めない**。理由は以下の通り:

- Cache Write は TTL ごとに 1 回のみ発生し、大量のリクエストに対して按分すると無視できるレベルである
- 例: Anthropic Opus 4.6 で 2,000 文字（約 3,000 トークン）のシステムプロンプトの場合、Cache Write は 1 回あたり約 $0.000019。1 日 100 リクエストでも TTL あたりの Write コストは全体の 0.1% 未満
- 本システムの目的は「上限値の算定」であり、Cache Write の有無は上限に影響しない（Caching ON は常にコスト削減方向に作用するため）

### 5.6 長文コンテキスト（200K tokens 超過）の計算ポリシー

一部プロバイダーでは、プロンプトが 200K tokens を超えた場合に割増料金が適用される。

#### 対象プロバイダーと割増率

| プロバイダー | 条件 | 割増率 | 参照 |
|-------------|------|--------|------|
| Anthropic | プロンプトが 200K tokens を超過 | Input/Output ともに 1.5〜2 倍 | セクション 6.3 |
| Google（Gemini 2.5 以降） | プロンプトが 200K tokens を超過 | Input/Output ともに 2 倍 | セクション 6.4 |
| OpenAI | 特になし（モデルごとのコンテキスト長上限あり） | — | セクション 6.2 |

#### 計算ポリシー

本システムでは、1 リクエストあたりの推定インプットトークン数が 200K tokens を超える場合、**該当プロバイダーの割増料金を自動適用する**。

```
推定インプットトークン数 =
  システムプロンプト + ユーザー入力 + 会話履歴 + RAG チャンク + Web 結果
  （各文字数 × トークン換算係数で算出）

判定:
  推定インプットトークン数 > 200,000 の場合:
    Anthropic → Input 単価を 2 倍、Output 単価を 2 倍に適用（保守的に最大倍率を採用）
    Google    → Input 単価を 2 倍、Output 単価を 2 倍に適用
    OpenAI    → 変更なし（コンテキスト長上限を超えた場合は警告表示のみ）
```

※ 上限値算定の目的に基づき、Anthropic の「1.5〜2 倍」は保守的に **2 倍** を採用する。

### 5.7 無料枠の計算ポリシー

一部プロバイダーの Web 検索ツールには無料枠が設定されている。

| プロバイダー | 無料枠 | 参照 |
|-------------|--------|------|
| Google（Gemini 3 系） | 月 5,000 クエリまで無料 | セクション 6.4 |
| Google（Gemini 2.x 系） | 日 1,500 プロンプトまで無料 | セクション 6.4 |

#### 計算ポリシー

本システムでは、**無料枠は考慮せず、全クエリに対して課金単価を適用する**。

理由:
- 本システムの目的は「最大でこれくらいになる（これ以上にはならない）」という上限値の算定である
- 無料枠を考慮すると実際のコストが上限を超える可能性がある（無料枠は変更・廃止される可能性がある）
- 無料枠を差し引いた結果は「最低でもこれくらい」の下限に近い値であり、本システムの目的と異なる

---

## 6. モデル料金マスターデータ

> **最終取得日: 2026-02-14**
> 各プロバイダーの公式ドキュメントより取得。料金は変動するため、定期的な更新が必要。

### 6.1 管理するデータ項目

| 項目 | 説明 |
|------|------|
| プロバイダー | OpenAI / Anthropic / Google |
| モデル名 | 各モデルの正式名称 |
| カテゴリ | flagship / standard / lightweight / reasoning / embedding |
| インプットトークン単価 | USD per 1M tokens |
| アウトプットトークン単価 | USD per 1M tokens |
| キャッシュ書き込み単価（Cache Write） | Prompt Caching 書き込み時の単価（Anthropic 等で必要。OpenAI/Google は null） |
| キャッシュ読み取り単価（Cache Read） | Prompt Caching ヒット時の割引単価（全プロバイダー共通で使用） |
| 最大コンテキスト長 | トークン数上限 |
| 最終更新日 | 料金改定の追跡用 |

### 6.2 OpenAI モデル料金一覧

#### テキスト生成モデル

| モデル | カテゴリ | Input ($/1M tokens) | Cached Input ($/1M tokens) | Output ($/1M tokens) | コンテキスト長 |
|--------|---------|--------------------:|---------------------------:|---------------------:|---------------|
| GPT-5.2 | flagship | $1.750 | $0.175 | $14.000 | — |
| GPT-5.2 pro | flagship (高精度) | $21.000 | — | $168.000 | — |
| GPT-5 mini | flagship (軽量) | $0.250 | $0.025 | $2.000 | — |
| GPT-4.1 | standard | $2.000 | $0.500 | $8.000 | 1M tokens |
| GPT-4.1 mini | standard (軽量) | $0.400 | $0.100 | $1.600 | 1M tokens |
| GPT-4.1 nano | lightweight | $0.100 | $0.025 | $0.400 | 1M tokens |
| GPT-4o | standard | $2.500 | $1.250 | $10.000 | 128K tokens |
| GPT-4o-mini | lightweight | $0.150 | $0.075 | $0.600 | 128K tokens |

#### 推論（Reasoning）モデル

| モデル | カテゴリ | Input ($/1M tokens) | Cached Input ($/1M tokens) | Output ($/1M tokens) | コンテキスト長 |
|--------|---------|--------------------:|---------------------------:|---------------------:|---------------|
| o4-mini | reasoning | $1.100 | — | $4.400 | — |
| o3-mini | reasoning | $1.100 | — | $4.400 | — |

#### Embedding モデル

| モデル | Input ($/1M tokens) | 次元数 |
|--------|--------------------:|--------|
| text-embedding-3-small | $0.020 | 1,536 |
| text-embedding-3-large | $0.130 | 3,072 |

#### Web Search ツール

| ツール | 料金 |
|--------|------|
| Web Search（全モデル共通） | $10.00 / 1K calls + 検索コンテンツトークンはモデルのインプット単価で課金 |

### 6.3 Anthropic (Claude) モデル料金一覧

#### テキスト生成モデル（最新）

| モデル | カテゴリ | Input ($/1M tokens) | Output ($/1M tokens) | Cache Write ($/1M tokens) | Cache Read ($/1M tokens) | コンテキスト長 |
|--------|---------|--------------------:|---------------------:|--------------------------:|-------------------------:|---------------|
| Claude Opus 4.6 | flagship | $5.000 | $25.000 | $6.250 | $0.500 | 200K tokens |
| Claude Sonnet 4.5 | standard | $3.000 | $15.000 | $3.750 | $0.300 | 200K tokens |
| Claude Haiku 4.5 | lightweight | $1.000 | $5.000 | $1.250 | $0.100 | 200K tokens |

※ 200K tokens を超えるプロンプトの場合、Input/Output ともに 1.5〜2 倍の料金が適用される。

#### レガシーモデル（参考）

| モデル | カテゴリ | Input ($/1M tokens) | Output ($/1M tokens) | Cache Write ($/1M tokens) | Cache Read ($/1M tokens) |
|--------|---------|--------------------:|---------------------:|--------------------------:|-------------------------:|
| Claude Opus 4.5 | flagship | $5.000 | $25.000 | $6.250 | $0.500 |
| Claude Opus 4.1 | flagship | $15.000 | $75.000 | $18.750 | $1.500 |
| Claude Sonnet 4 | standard | $3.000 | $15.000 | $3.750 | $0.300 |
| Claude Opus 4 | flagship | $15.000 | $75.000 | $18.750 | $1.500 |
| Claude Haiku 3 | lightweight | $0.250 | $1.250 | $0.300 | $0.030 |

#### Embedding モデル

Anthropic は独自の Embedding モデルを提供していない。RAG 構成時は OpenAI または Google の Embedding モデルを使用する。

#### Web Search ツール

| ツール | 料金 |
|--------|------|
| Web Search | $10.00 / 1K searches（インプット/アウトプットトークンは別途モデル単価で課金） |

### 6.4 Google (Gemini) モデル料金一覧

※ Vertex AI の Standard tier 料金を記載。Google AI Studio 利用時は料金が異なる場合がある。

#### テキスト生成モデル（最新）

| モデル | カテゴリ | Input ($/1M tokens) | Cached Input ($/1M tokens) | Output ($/1M tokens) | コンテキスト長 |
|--------|---------|--------------------:|---------------------------:|---------------------:|---------------|
| Gemini 3 Pro Preview | flagship | $2.000 | $0.200 | $12.000 | 200K tokens |
| Gemini 3 Flash Preview | standard | $0.500 | $0.050 | $3.000 | 200K tokens |
| Gemini 2.5 Pro | flagship | $1.250 | $0.125 | $10.000 | 200K tokens |
| Gemini 2.5 Flash | standard | $0.300 | $0.030 | $2.500 | 200K tokens |
| Gemini 2.5 Flash Lite | lightweight | $0.100 | $0.010 | $0.400 | 200K tokens |
| Gemini 2.0 Flash | standard | $0.150 | — | $0.600 | — |
| Gemini 2.0 Flash Lite | lightweight | $0.075 | — | $0.300 | — |

※ 200K tokens を超えるプロンプトの場合、料金が 2 倍になる。

#### Embedding モデル

| モデル | Input ($/1M tokens) | 備考 |
|--------|--------------------:|------|
| Gemini Embedding（オンライン） | $0.150 | 最新の Gemini ベース Embedding |
| Gemini Embedding（バッチ） | $0.120 | バッチ処理時 |

#### Grounding（Web 検索）

| ツール | 料金 |
|--------|------|
| Grounding with Google Search（Gemini 3 系） | $14.00 / 1K queries（月 5,000 クエリまで無料） |
| Grounding with Google Search（Gemini 2.x 系） | $35.00 / 1K grounded prompts（日 1,500 プロンプトまで無料） |

### 6.5 プロバイダー横断比較（コスト感の目安）

#### 高性能モデル比較

| モデル | Input | Output | 合計コスト目安（1K入力 + 0.5K出力トークン）|
|--------|------:|-------:|------------------------------------------:|
| GPT-5.2 | $1.750 | $14.000 | $0.00875 |
| Claude Opus 4.6 | $5.000 | $25.000 | $0.01750 |
| Gemini 3 Pro Preview | $2.000 | $12.000 | $0.00800 |
| Gemini 2.5 Pro | $1.250 | $10.000 | $0.00625 |

#### 軽量モデル比較（コスト重視の用途向け）

| モデル | Input | Output | 合計コスト目安（1K入力 + 0.5K出力トークン）|
|--------|------:|-------:|------------------------------------------:|
| GPT-4.1 nano | $0.100 | $0.400 | $0.00030 |
| GPT-4o-mini | $0.150 | $0.600 | $0.00045 |
| Claude Haiku 4.5 | $1.000 | $5.000 | $0.00350 |
| Gemini 2.5 Flash Lite | $0.100 | $0.400 | $0.00030 |
| Gemini 2.0 Flash Lite | $0.075 | $0.300 | $0.00023 |

#### Embedding モデル比較

| モデル | Input ($/1M tokens) |
|--------|--------------------:|
| text-embedding-3-small (OpenAI) | $0.020 |
| text-embedding-3-large (OpenAI) | $0.130 |
| Gemini Embedding (Google) | $0.150 |

---

## 7. アーキテクチャ

### 7.1 技術スタック

| カテゴリ | 技術 | 用途 |
|---------|------|------|
| フレームワーク | **Next.js** (App Router) | フロントエンド + API Routes |
| ホスティング | **Vercel** | デプロイ・CDN・エッジ配信 |
| データベース | **Neon** (PostgreSQL) | モデル料金マスターデータの管理 |
| ORM | **Drizzle ORM** | Neon との接続・型安全なクエリ |
| UI ライブラリ | **shadcn/ui** + **Tailwind CSS** | WCAG 2.2 準拠のモダン UI |
| フォーム管理 | **React Hook Form** + **Zod** | バリデーション付きフォーム制御 |
| グラフ/可視化 | **Recharts** | コスト内訳の円グラフ・棒グラフ表示 |

### 7.2 構成方針

| 項目 | 方針 |
|------|------|
| 認証 | **不要**（誰でも利用可能） |
| 管理画面 | **不要**（マスターデータはシードスクリプトで投入） |
| 算出履歴の保存 | **不要**（計算はその場で完結） |
| マスターデータ更新 | シードスクリプト（`db:seed`）で投入・更新。料金改定時はシードデータを修正して再実行 |
| API 設計 | Next.js API Routes（Server Side）からマスターデータを取得。クライアントから直接 DB アクセスしない |
| コスト計算 | サーバーサイドでマスターデータ取得 → クライアントサイドで計算処理 |

### 7.3 データベース設計（概要）

Neon に格納するテーブル:

- **providers**: プロバイダー情報（OpenAI, Anthropic, Google）
- **models**: テキスト生成モデル情報（モデル名、カテゴリ、Input/Output 単価、Cache Write 単価、Cache Read 単価、コンテキスト長）
- **embedding_models**: Embedding モデル情報（モデル名、単価、次元数、料金ティア。Google Embedding はオンライン/バッチの2件として保持）
- **web_search_tools**: Web 検索ツール情報（ツール名、単価体系）

### 7.4 ディレクトリ構成（予定）

```
llm-price-cul/
├── docs/
│   └── requirement.md
├── src/
│   ├── app/
│   │   ├── layout.tsx
│   │   ├── page.tsx              # モード選択 + 入力 + 結果表示
│   │   └── api/
│   │       └── models/
│   │           └── route.ts      # マスターデータ取得 API
│   ├── components/
│   │   ├── ui/                   # shadcn/ui コンポーネント
│   │   ├── SimpleMode.tsx        # ざっくり算定モード
│   │   ├── DetailedMode.tsx      # 詳細算定モード
│   │   └── CostResult.tsx        # 結果表示
│   ├── lib/
│   │   ├── db/
│   │   │   ├── index.ts          # Drizzle クライアント
│   │   │   ├── schema.ts         # テーブル定義
│   │   │   └── seed.ts           # シードデータ
│   │   ├── calculation/
│   │   │   └── cost-calculator.ts # コスト計算ロジック
│   │   └── constants/
│   │       └── defaults.ts       # デフォルト値定義
│   └── types/
│       └── index.ts              # 型定義
├── drizzle/
│   └── migrations/               # マイグレーションファイル
├── .env
├── .env.local
├── .gitignore
├── drizzle.config.ts
├── next.config.ts
├── package.json
├── tailwind.config.ts
└── tsconfig.json
```

---

## 8. 非機能要件

| 項目 | 要件 |
|------|------|
| レスポンシブ対応 | PC・タブレット・スマートフォンで閲覧可能 |
| アクセシビリティ | WCAG 2.2 準拠 |
| データ永続化 | マスターデータのみ Neon に保持。算出結果は保存しない |
| API 設計 | マスターデータは API Routes 経由で取得（クライアントから直接 DB アクセスしない） |
| ブラウザ対応 | モダンブラウザ（Chrome, Firefox, Safari, Edge 最新版） |
| マスターデータ管理 | シードスクリプトで投入。料金改定時はシードデータを修正して `db:seed` を再実行 |

---

## 9. 画面構成（概要）

1. **モード選択**: ざっくり算定 / 詳細算定 のタブまたはトグル切り替え
2. **入力フォーム**: 選択したモードに応じたパラメータ入力フォーム
3. **結果表示**: 月額コスト算出結果の表示（内訳付き）
   - 各処理ステップごとのコスト内訳
   - インプット/アウトプットトークン数の内訳
   - 日次・月次のコスト表示
   - USD / JPY の切り替え表示
   - コスト内訳のグラフ可視化
